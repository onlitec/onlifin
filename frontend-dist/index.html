<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/favicon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <title>OnliFin - GestÃ£o Financeira Pessoal</title>
  <meta name="description" content="OnliFin - Plataforma de gestÃ£o financeira pessoal com assistente de IA" />

  <link rel="manifest" href="/manifest.json" />

  <meta name="theme-color" content="#3b82f6" />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#3b82f6" />
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0f172a" />

  <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png" />
  <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-192x192.png" />

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="OnliFin" />

  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="OnliFin" />

  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  <meta name="msapplication-TileColor" content="#3b82f6" />
  <meta name="msapplication-config" content="/browserconfig.xml" />

  <meta property="og:type" content="website" />
  <meta property="og:title" content="OnliFin - GestÃ£o Financeira Pessoal" />
  <meta property="og:description" content="Plataforma de gestÃ£o financeira pessoal com assistente de IA" />
  <meta property="og:image" content="/icons/icon-512x512.png" />
  <meta property="og:site_name" content="OnliFin" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="OnliFin - GestÃ£o Financeira Pessoal" />
  <meta name="twitter:description" content="Plataforma de gestÃ£o financeira pessoal com assistente de IA" />
  <meta name="twitter:image" content="/icons/icon-512x512.png" />
  <script type="module" crossorigin src="/assets/index-y3fZvIOx.js"></script>
  <link rel="stylesheet" crossorigin href="/assets/index-CPD2LvWt.css">
  <script>
    (function () {
      const redirect = new URLSearchParams(location.search).get('redirect');
      if (redirect && redirect !== location.pathname) {
        history.replaceState(null, '', redirect);
      }
    })();
  </script>
  <link rel="stylesheet" id="fonts-code" href="https://miaoda-font.cdn.bcebos.com/static/font_v1/fonts-code.css">
</head>

<body class="dark:bg-gray-900">
  <div id="root"></div>
  <script id="md-click">
    window.mdClick = e => {
      const target = e.target;
      const { href, target: linkTarget } = target.dataset;
      const appType = 'web';
      const isBlank = linkTarget === '_blank';

      if (!href) return;

      e.stopPropagation();
      e.preventDefault();

      // å¤–éƒ¨é“¾æ¥æˆ–æ–°çª—å£æ‰“å¼€
      if (isBlank || href.startsWith('http')) {
        let finalHref = href;
        if (appType === 'miniapp' && !href.startsWith('http')) {
          finalHref = window.location.href.split('#')[0] + '#/' + href;
        }
        window.open(finalHref, linkTarget || '_self');
        return;
      }

      // å†…éƒ¨è·¯ç”±è·³è½¬
      const finalHref = href.startsWith('/') ? href : '/' + href;
      if (appType === 'miniapp') {
        window.location.hash = finalHref;
        window.dispatchEvent(new HashChangeEvent('hashchange'));
      } else {
        window.history.pushState({}, '', finalHref);
        window.dispatchEvent(new Event('popstate'));
      }
    };
    document.addEventListener('click', window.mdClick, true);
  </script>
  <script id="iframe-onerror-catcher">
    const observer = new PerformanceObserver((list) => {
      list.getEntries().forEach((entry) => {
        if (entry.initiatorType === 'script' && entry.responseStatus >= 400) {
          window.parent.postMessage({
            type: "RESOURCE_LOAD_ERROR",
            name: entry.name,
            status: entry.responseStatus
          }, "*");
          console.warn('[iframe-error] Resource failed:', entry.name, entry.responseStatus);
        }
      });
    });
    observer.observe({ type: 'resource', buffered: true });
  </script>
  <!-- OnliFin JWT Authentication Patch - Must load first -->
  <script>
    // Aggressive Cache & Service Worker Nuke
    (function () {
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(regs => {
          for (let reg of regs) { reg.unregister(); }
        });
      }

      // Self-Repair: If app is blank for 5 seconds, clear everything
      setTimeout(() => {
        const root = document.getElementById('root');
        if (root && root.innerHTML === '' && window.location.pathname !== '/login') {
          console.error('ğŸš€ App stuck, self-repairing...');
          localStorage.clear();
          sessionStorage.clear();
          window.location.href = '/login?repair=true';
        }
      }, 5000);

      // Force reload if we find corrupt logic (ID undefined)
      const session = localStorage.getItem('onlifin_auth_session');
      if (session && (session.includes('"id":null') || session.includes('"id":"undefined"'))) {
        localStorage.clear();
        window.location.reload();
      }
    })();
  </script>
  <!-- OnliFin Authentication System - Fixed v4.0 -->
  <script src="/auth-jwt-patch.js?v=4.0" defer></script>
  <!-- OnliFin Admin Tools -->
  <script src="/admin-user-patch.js?v=4.0" defer></script>
  <!-- OnliFin Dashboard Enhancement -->
  <script src="/dashboard-enhancement.js?v=4.0" defer></script>
</body>

</html>